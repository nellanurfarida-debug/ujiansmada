<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CBT Lokal SMAS Plus Darussalam</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { background: #f3f4f6; }
  </style>
</head>

<body class="bg-gray-100">

<!-- HEADER -->
<header class="bg-green-700 text-white p-4 flex justify-between items-center">
  <h1 class="font-bold text-lg">CBT SMAS Plus Darussalam</h1>

  <!-- TOMBOL PANITIA -->
  <div id="btn-panitia" class="cursor-pointer text-sm hover:text-yellow-300">
    <i class="fas fa-lock"></i> Panitia
  </div>
</header>

<!-- LOGIN SISWA -->
<div id="view-login" class="p-6 max-w-md mx-auto mt-10 bg-white rounded shadow">
  <h2 class="text-xl font-bold mb-4 text-center">Login Siswa</h2>

  <input id="nama" placeholder="Nama" class="w-full border p-2 rounded mb-3">

  <select id="kelas" class="w-full border p-2 rounded mb-3">
    <option value="">Pilih Kelas...</option>
    <option>X</option>
    <option>XI</option>
    <option>XII IBB</option>
    <option>XII IIS</option>
  </select>

  <button onclick="masukUjian()" class="w-full bg-green-600 text-white py-2 rounded">
    Masuk
  </button>
</div>

<!-- VIEW MENUNGGU -->
<div id="view-wait" class="hidden p-6 max-w-md mx-auto mt-10 bg-white rounded shadow text-center">
  <h2 class="text-xl font-bold mb-2">Menunggu Ujian Dimulai</h2>
  <p class="text-gray-600 mb-6">Tunggu panitia memulai ujian.</p>
</div>

<!-- EXAM VIEW -->
<div id="view-exam" class="hidden fixed inset-0 bg-white flex flex-col">
  <div class="bg-gray-800 text-white p-3 flex justify-between items-center">
    <div>
      <div id="exam-nama" class="font-bold"></div>
      <div id="exam-kelas" class="text-xs text-gray-300"></div>
    </div>

    <button onclick="selesai()" class="bg-red-600 px-4 py-1 rounded text-sm">
      Selesai
    </button>
  </div>

  <iframe id="pdf" class="flex-1 w-full"></iframe>
</div>

<!-- LOGIN PANITIA -->
<div id="view-admin-login" class="hidden p-6 max-w-sm mx-auto mt-20 bg-white rounded shadow">
  <h2 class="text-lg font-bold mb-4">Login Panitia</h2>

  <input id="admin-user" placeholder="Username" class="w-full border p-2 rounded mb-3">
  <input id="admin-pass" placeholder="Password" type="password" class="w-full border p-2 rounded mb-3">

  <button onclick="adminMasuk()" class="w-full bg-gray-800 text-white py-2 rounded">
    Masuk
  </button>
</div>
<!-- PANEL ADMIN -->
<div id="view-admin" class="hidden p-6 max-w-3xl mx-auto mt-10 bg-white rounded shadow">

  <h2 class="text-xl font-bold mb-4">Panel Panitia</h2>

  <!-- INPUT LINK SOAL PER KELAS -->
  <label class="block mb-1 font-semibold">Link Soal Kelas X</label>
  <input id="link-x" class="w-full border p-2 rounded mb-3">

  <label class="block mb-1 font-semibold">Link Soal Kelas XI</label>
  <input id="link-xi" class="w-full border p-2 rounded mb-3">

  <label class="block mb-1 font-semibold">Link Soal XII IBB</label>
  <input id="link-xii-ibb" class="w-full border p-2 rounded mb-3">

  <label class="block mb-1 font-semibold">Link Soal XII IIS</label>
  <input id="link-xii-iis" class="w-full border p-2 rounded mb-3">

  <button onclick="mulaiSemua()" class="w-full bg-green-600 text-white py-2 rounded mb-3">
    Mulai Ujian
  </button>

  <button onclick="location.reload()" class="w-full border border-red-400 text-red-600 py-2 rounded">
    Keluar
  </button>

</div>

<!-- ========================= -->
<!-- ==== JAVASCRIPT CORE ==== -->
<!-- ========================= -->

<script>

let siswa = {};
let soal = {};

// Fungsi ganti tampilan
function show(id){
  document.querySelectorAll('[id^=view]').forEach(v => v.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// TOMBOL PANITIA DI HEADER
document.getElementById("btn-panitia").onclick = () => show("view-admin-login");

// LOGIN PANITIA
function adminMasuk(){
  const u = document.getElementById("admin-user").value;
  const p = document.getElementById("admin-pass").value;

  if(u === "admin ujian" && p === "smadalawang20517826"){
    show("view-admin");
  } else {
    alert("Username atau password salah!");
  }
}

// LOGIN SISWA
function masukUjian(){
  let nama = document.getElementById("nama").value;
  let kelas = document.getElementById("kelas").value;

  if(!nama || !kelas){
    return alert("Isi semua field!");
  }

  siswa = { nama, kelas };
  show("view-wait");
}

// PANITIA MENEKAN MULAI UJIAN
function mulaiSemua(){
  soal = {
    "X": document.getElementById("link-x").value,
    "XI": document.getElementById("link-xi").value,
    "XII IBB": document.getElementById("link-xii-ibb").value,
    "XII IIS": document.getElementById("link-xii-iis").value
  };

  mulaiUjian();
}

// MASUK KE TAMPILAN UJIAN
function mulaiUjian(){
  const link = soal[siswa.kelas];
  if(!link){
    return alert("Panitia belum mengatur link soal untuk kelas ini!");
  }

  document.getElementById("pdf").src = link;
  document.getElementById("exam-nama").innerText = siswa.nama;
  document.getElementById("exam-kelas").innerText = siswa.kelas;

  show("view-exam");
}

// SELESAI UJIAN
function selesai(){
  alert("Jawaban terkirim. Anda telah menyelesaikan ujian.");
  location.reload();
}
/* =======================================================
   ANTI CHEAT SEDERHANA (OPSIONAL — SUDAH AKTIF)
   ======================================================= */
// Jika siswa keluar tab lebih dari 3 kali → otomatis reset ujian
let cheatCount = 0;

document.addEventListener("visibilitychange", () => {
  if (document.hidden && document.getElementById("view-exam") &&
      !document.getElementById("view-exam").classList.contains("hidden")) {

    cheatCount++;

    if (cheatCount >= 3) {
      alert("Anda keluar dari tab terlalu sering. Ujian dibatalkan.");
      location.reload();
    } else {
      alert("Peringatan! Jangan keluar dari tab ujian! (" + cheatCount + "/3)");
    }
  }
});
</script>

</body>
</html>
